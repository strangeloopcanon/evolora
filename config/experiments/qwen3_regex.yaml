# Regex evolution config (EcologyConfig schema).
#
# This config is intended for the "evolution vs compute-matched SFT" regex track:
# - Evolution run: `python scripts/run_evolution.py --config config/experiments/qwen3_regex.yaml ...`
# - Compute-matched SFT (recommended: match evo train compute via tokens + multiplier):
#     `python scripts/run_sft.py --checkpoint <run_dir>/checkpoint.pt --match-budget-field train_tokens --backprop-multiplier 2.0 --attn-implementation eager --engine manual --resume --data <run_dir>/datasets/sft_train.jsonl --model Qwen/Qwen3-0.6B ...`
#   (Alternative: wall-clock match via `--match-budget-field wall_clock_seconds`.)
# - Holdout eval: `python scripts/evaluate_holdout.py --holdout <run_dir>/datasets/holdout_tasks.jsonl --evo-selection-tasks <run_dir>/datasets/selection_tasks.jsonl ...`
host:
  backbone_type: gemma
  backbone_model: Qwen/Qwen3-0.6B
  tokenizer: Qwen/Qwen3-0.6B
  device: mps
  max_lora_rank: 8
  max_sequence_length: 256
  gen_max_new_tokens: 64

grid:
  families: [regex]
  depths: [short, medium, long]

controller:
  tau: 0.5
  beta: 0.2
  eta: 0.5

pricing:
  base: 1.0
  k: 1.5
  min: 0.3
  max: 2.0

energy:
  Emax: 5.0
  m: 1.0
  alpha: 1.0e-14
  beta: 0.02
  gamma: 0.001
  lambda_p: 1.0e-7
  bankruptcy_grace: 3
  cost_scale: 1.0

canary:
  q_min: 0.95

population_strategy:
  mu: 4
  lambda: 12
  max_population: 16
  initial_orgs: 4

evolution:
  mutation_rate: 0.05
  max_merges_per_gen: 3
  min_population: 4
  max_population: 16

assimilation_tuning:
  per_cell_interval: 5
  max_merges_per_cell: 1
  seed_scale: 0.5
  soup_size: 3
  holdout_tasks_path: config/evaluation/holdout_regex.jsonl
  holdout_sample_size: 8
  holdout_margin: 0.02
  bootstrap_uplift_enabled: false
  bootstrap_samples: 100
  permutation_samples: 100
  dr_enabled: true
  dr_min_power: 0.2
  hf_prompts:
    - "Summarize your solution for a non-technical reviewer."
    - "Suggest a follow-up action we can validate manually."

environment:
  synthetic_batch_size: 2
  max_episode_steps: 128
  energy_budget: 50.0

human_bandit:
  enabled: false

# Disable periodic evaluation-by-holdout during training for clean comparisons.
evaluation:
  enabled: false
  cadence: 10
  tasks_path: config/evaluation/holdout_regex.jsonl
  sample_size: 8
  reward_weight: 0.75

comms:
  enabled: false

policy:
  enabled: false
